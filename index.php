<?php
    include('include/init.php');
    tokenSetup();
    $userId = $_SESSION['userId'] ?? createUser(tokenSetup());
    // saveTracksToDB($userId); // this was commented out to make reloads faster. still havent found a good way to save all your songs to the db at once. 
    // maybe we should scan all the songs in the database for songs that match the songs that a new user is trying to upload and cancel those uploads while just uploading to the songs to users table
    // also we might store a pointer to what point in the amount of songs that a we are into uploading a specific user's songs and push that counter forward each time we upload data about a new batch or access that the song is available. 


?>

<html>

<head>
    <meta charset="utf-8" name="viewport" content="width=device-width">
    <title>Sprintify</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/footer.css">
    <script type="text/javascript" src="scripts/main.js"></script>
</head>

<body>
    <div class="header">
        <div class="title"> 
            <h1>Sprintify</h1>
        </div>
        <div id="avatar"></div>
        <div id="displayName"></div>
        <div id="email"></div>
        <div id="url" style="display:none"></div>
    </div>
    <div class="homeContainer"> 
        <div>new run</div>
        <form id="userData" action="display_playlist.php" method="POST">
            <strong>distance:</strong> <input type="text" id="runDistance" name="run_distance" value="3"/> miles <br>
            <strong>desired pace:</strong> <input type="text" id="pace" name="pace" value="10"/> min/mi <br> 
            <input type="submit" value="go!"/> 
        </form> 
    </div>
    <div class="footer">
        <button>home</button>
        <button>
            <div>
                <svg width="33" height="32" viewBox="0 0 33 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_81_665)">
                    <path d="M28.9916 19.0082L29.4281 19.1937L29.435 19.1967C29.7414 19.328 30.0481 19.47 30.3549 19.6234C30.9782 19.935 31.4644 20.3908 31.8178 20.9935C32.1727 21.5991 32.35 22.2557 32.35 22.9672V26.4164H28.85V18.9564C28.8975 18.9742 28.9452 18.99 28.9916 19.0082ZM16.6 17.5834C18.0461 17.5834 19.4702 17.7582 20.8725 18.1088V18.1097H20.8764C22.2776 18.4382 23.6586 18.9416 25.019 19.6215V19.6224C25.6199 19.9334 26.0961 20.3887 26.4506 20.9935L26.4565 21.0023C26.8297 21.5831 27.0169 22.2246 27.017 22.933V26.4164H6.18301V22.933C6.18308 22.2224 6.3601 21.5794 6.71231 20.9984C7.08954 20.3907 7.57879 19.9341 8.18106 19.6224L8.18008 19.6215C9.54069 18.9414 10.9221 18.4382 12.3236 18.1097L12.3275 18.1088C13.7298 17.7582 15.1539 17.5834 16.6 17.5834ZM4.35001 26.4164H0.850006V22.9672L0.858795 22.7025C0.897572 22.092 1.0717 21.5234 1.38223 20.9935C1.73558 20.3908 2.22186 19.935 2.84512 19.6234C3.15183 19.4701 3.44748 19.328 3.73184 19.1967C3.93274 19.1106 4.13932 19.0312 4.35001 18.9545V26.4164ZM16.6 19.7504C15.3358 19.7504 14.083 19.9075 12.8422 20.223C11.6 20.5166 10.3707 20.9685 9.15469 21.5765L9.14493 21.5814C8.90844 21.7129 8.71322 21.897 8.55899 22.1283L8.55313 22.1361L8.54825 22.1449C8.41516 22.3845 8.35007 22.6492 8.35001 22.933V24.2504H24.85V22.933C24.8499 22.6467 24.7716 22.3825 24.6176 22.1449H24.6186C24.5183 21.9644 24.387 21.8126 24.226 21.6918L24.0551 21.5814L24.0453 21.5765L23.5883 21.3558C22.6738 20.9292 21.7519 20.591 20.8227 20.3412L20.3578 20.223C19.117 19.9075 17.8642 19.7504 16.6 19.7504ZM5.93301 9.58337C6.97858 9.58337 7.85988 9.94676 8.59024 10.6771C9.32038 11.4074 9.68301 12.288 9.68301 13.3334C9.68301 14.3788 9.32038 15.2593 8.59024 15.9896C7.85988 16.72 6.97858 17.0834 5.93301 17.0834C4.88759 17.0833 4.00705 16.7199 3.27676 15.9896C2.54651 15.2593 2.18301 14.3789 2.18301 13.3334C2.18301 12.2879 2.54651 11.4075 3.27676 10.6771C4.00705 9.94684 4.88759 9.58345 5.93301 9.58337ZM27.267 9.58337C28.3124 9.58345 29.193 9.94684 29.9232 10.6771C30.6535 11.4075 31.017 12.2879 31.017 13.3334C31.017 14.3789 30.6535 15.2593 29.9232 15.9896C29.193 16.7199 28.3124 17.0833 27.267 17.0834C26.2214 17.0834 25.3401 16.72 24.6098 15.9896C23.8796 15.2593 23.517 14.3788 23.517 13.3334C23.517 12.288 23.8796 11.4074 24.6098 10.6771C25.3401 9.94676 26.2214 9.58337 27.267 9.58337ZM16.6 5.58337C17.9998 5.58337 19.1919 6.07871 20.1898 7.07654C21.1877 8.07439 21.6829 9.26669 21.683 10.6664C21.683 12.0661 21.1877 13.2583 20.1898 14.2562C19.1919 15.2542 17.9998 15.7504 16.6 15.7504C15.2002 15.7504 14.0081 15.2542 13.0102 14.2562C12.0123 13.2583 11.517 12.0661 11.517 10.6664C11.5171 9.26669 12.0123 8.07439 13.0102 7.07654C14.0081 6.07871 15.2002 5.58337 16.6 5.58337ZM5.93301 11.7504C5.4892 11.7504 5.10302 11.9095 4.78946 12.223C4.49362 12.5189 4.35001 12.8961 4.35001 13.3334C4.35001 13.7707 4.4939 14.1541 4.78262 14.4691L4.78946 14.4769L4.79727 14.4847C5.11217 14.7734 5.49587 14.9163 5.93301 14.9164C6.37028 14.9164 6.74747 14.7728 7.04337 14.4769C7.35701 14.1633 7.517 13.7773 7.517 13.3334C7.517 12.8962 7.36081 12.5229 7.0502 12.2308H7.05118C6.75707 11.91 6.37734 11.7504 5.93301 11.7504ZM27.267 11.7504C26.8232 11.7504 26.437 11.9095 26.1234 12.223C25.8275 12.5189 25.683 12.8961 25.683 13.3334C25.683 13.7707 25.8269 14.1541 26.1156 14.4691L26.1313 14.4847C26.4462 14.7733 26.8299 14.9164 27.267 14.9164C27.704 14.9163 28.0806 14.7726 28.3764 14.4769C28.69 14.1633 28.85 13.7773 28.85 13.3334C28.85 12.8961 28.6939 12.5229 28.3832 12.2308H28.3842C28.0902 11.9102 27.7111 11.7504 27.267 11.7504ZM16.6 7.75037C15.7983 7.75037 15.1016 8.04469 14.5229 8.62341C13.9644 9.18204 13.6831 9.86809 13.683 10.6664C13.683 11.4646 13.9638 12.1602 14.519 12.7396L14.5268 12.7474C15.1063 13.3028 15.8017 13.5834 16.6 13.5834C17.3984 13.5834 18.0843 13.3021 18.643 12.7435C19.2217 12.1648 19.517 11.4681 19.517 10.6664C19.5169 9.86448 19.2211 9.1773 18.6391 8.61951C18.0826 8.04266 17.3984 7.75037 16.6 7.75037Z" fill="#1D1B20" stroke="#CCCCCC" stroke-width="0.5"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_81_665">
                    <rect width="32" height="32" fill="white" transform="translate(0.600006)"/>
                    </clipPath>
                    </defs>
                </svg>
            </div>
            <div>friends</div></button>
        <button>start</button>
        <button>past</button>
        <button>settings</button>
    </div>
    <script defer>
        const profile = <?php echo getSpotifyProfile($userId); ?>;
        populateUI(profile);
   </script>
</body>

</html>